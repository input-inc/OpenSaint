YUI.add("yg-inline-image",function(b){var a=b.Base.create("yg-inline-image",b.Base,[],{initializer:function(c){this.contentBox=c.contentBox;this.view=c.view;this.fileList={};this.uploadedFilesList=[];b.Uploader.SELECT_FILES_BUTTON='<div role="button" href="" class="yg-sprite link-attachment"></div>';this.uploading=false;this.imageCount=0;this.imageHeight=200;this.inlineImages=[];this.initUploader()},initUploader:function(){var f=this.contentBox.one(".insert-image"),d;var c=this,e;GROUPS.PAGE.getAuthToken(GROUPS.DETAIL_IO,false);this.contentBox.on("click",function(g){b.all(".yui3-resize-handles-wrapper").addClass("hide")});this.contentBox.delegate("click",function(g){g.stopPropagation();g.currentTarget.get("parentNode").one(".yui3-resize-handles-wrapper").removeClass("hide")},".inline-image-cont",this);if(c.contentBox.one(".att-err-msg")){c.contentBox.one(".att-err-msg").addClass("hide")}if(b.Uploader.TYPE!="none"){this.uploader=new b.Uploader({width:"10px",height:"10px",multipleFiles:false,swfURL:"/swf/flashuploader.swf?t="+Math.random(),simLimit:2,fileFieldName:"filedata",selectFilesButton:b.Node.create(b.one("#image-uploader").get("innerHTML")),withCredentials:false,fileFilterFunction:function(g){return(GROUPS.UTILS.validateFormat(g)&&GROUPS.UTILS.maxUploadSizeCheck(g,GROUPS.MAX_PHOTO_UPLOAD_SIZE))}});this.uploader.render(f);var d=this.contentBox.one(".insert-image");if(d){d.setStyle("height","");d.setStyle("width","")}this.uploader.set("dragAndDropArea",this.contentBox);this.uploader.after("fileselect",function(g){c.fileSelectHandler(g)});this.uploader.on("uploadcomplete",function(h){c.uploading=false;c.uploader.set("fileList",[]);c.imageCount++;var i=b.JSON.parse(h.data),k=i.ygData,g=k.imageURL;c.inlineImages.push(k.attachmentPath);var j=new Image();j.onload=function(){GROUPS.INSTR.beaconClick("newtopic-container","rte-inline-image",11,false);var m=b.Node.create('<div class="yui3-resize-knob inline-image-cont"><img src="'+g+'" height='+c.imageHeight+"><p>&nbsp;</p></div>");if(c.contentBox.one(".content-area")){c.insertNodeOverSelection(m.getDOMNode(),c.contentBox.one(".content-area").getDOMNode())}else{if(c.contentBox.one(".msg-content")){c.insertNodeOverSelection(m.getDOMNode(),c.contentBox.one(".msg-content").getDOMNode())}}var l=this.height,n=this.width,p=c.contentBox.all("img").item(c.imageCount-1),o=new b.Resize({node:p});o.plug(b.Plugin.ResizeConstrained,{constrain:"#textarea-container"});p.get("parentNode").setStyle("width",(n*c.imageHeight/l)+"px");p.get("parentNode").setAttribute("contenteditable",false);c.contentBox.one(".file-list-container").addClass("hide")};j.src=g});this.uploader.on("uploadstart",function(g){c.uploading=true;GROUPS.UTILS.notifyScreenReader(GROUPS.YRB_STRINGS.STR_UPLOAD_POST_IMAGE,true)})}else{f.set("innerHTML",b.one("#image-uploader").get("innerHTML"));f.on("click",this.uploadAttachmentError)}},uploadAttachmentError:function(){b.one(".feedback-area").removeClass("hide").addClass("error").set("innerHTML",GROUPS.YRB_STRINGS.STR_UPLOADER_ERROR_1.replace("{0}",'<a href="https://get.adobe.com/flashplayer/" target="_blank">').replace("{1}","</a>"))},isOrContainsNode:function(c,d){var e=d;while(e){if(e===c){return true}e=e.parentNode}return false},insertNodeOverSelection:function(f,c){var g,d,e,h;if(window.getSelection){g=window.getSelection();if(g.getRangeAt&&g.rangeCount){d=g.getRangeAt(0);if(this.isOrContainsNode(c,d.commonAncestorContainer)){d.deleteContents();d.insertNode(f)}else{c.appendChild(f)}}else{c.appendChild(f)}}else{if(document.selection&&document.selection.createRange){d=document.selection.createRange();if(this.isOrContainsNode(c,d.parentElement())){e=(f.nodeType==3)?f.data:f.outerHTML;d.pasteHTML(e)}else{c.appendChild(f)}}else{c.appendChild(f)}}},fileSelectHandler:function(d){var i=d.fileList,g=this.contentBox.one(".file-list"),j=this,k={},e=0,f=0,h=0;if(this.contentBox.one(".file-list-container")){this.contentBox.one(".file-list-container").removeClass("hide")}if(this.uploader){this.uploader.set("fileList",i)}h=0;if(this.contentBox.one(".num-attachments")){this.contentBox.one(".num-attachments").set("text",GROUPS.YRB_STRINGS.STR_UPLOAD_POST_IMAGE);this.contentBox.one(".num-attachments").addClass("spinner")}if(j.uploader.get("fileList").length>0){var c="/api/v2/groups/"+j.view.get("groupName")+"/messages/attachment?gapi_crumb="+GROUPS.YG_CRUMB;j.uploader.uploadAll(c,{token:GROUPS.AUTH_TOKEN})}}});b.namespace("Groups").InlineImage=a},0.1,{requires:["node","base","event","yg-panel","uploader","resize"]});