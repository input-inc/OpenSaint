YUI.add("yg-plugin-swipe-page",function(c,b){c.namespace("Groups.Plugin.SwipePage");var a=c.Base.create(b,c.Plugin.Base,[],{initializer:function(d){this._node=d.host;this.attach()},attach:function(){if(c.Array.indexOf(this.get("bindDeviceType"),c.one("body").getAttribute("data-device"))!=-1){this._attach()}},detach:function(){if(this._flickHandler){this._flickHandler.detach()}},_attach:function(){this._flickHandler=c.one("body").on("flick",this._flickHandle,{minDistance:50,minVelocity:this.get("minVelocity")},this)},_flickHandle:function(i){var h=c.one("body").get("winWidth"),f=i.flick,j=f.distance,d=j>0,g;if(Math.abs(j)>h*this.get("minSwipeRatio")){if(d){g=this.get("swipeRightHandle")}else{g=this.get("swipeLeftHandle")}if(g){g.call(this._node)}}}},{NS:"swipePage",ATTRS:{minSwipeRatio:{value:0.5},minVelocity:{value:0.8},swipeLeftHandle:{value:null},swipeRightHandle:{value:null},bindDeviceType:{value:["mobile","tablet"]}}});c.Groups.Plugin.SwipePage=a},"0.1",{requires:["node","base","plugin","event","event-move"]});YUI.add("yg-message-attachments",function(b){var a=b.Base.create("messageAttachments",b.Base,[],{fileTypes:{"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{color:"green",alias:"XLS"},"image/vnd.adobe.photoshop":{color:"grey",alias:"PSD"},"application/zip":{color:"grey",alias:"ZIP"},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{color:"orange",alias:"PPT"},"application/pdf":{color:"orange",alias:"PDF"},"application/vnd.ms-excel":{color:"green",alias:"XLS"},"image/png":{color:"grey",alias:"PNG"},"audio/mpeg":{color:"grey",alias:"MP3"},"application/vnd.ms-powerpoint":{color:"orange",alias:"PPT"},"video/quicktime":{color:"grey",alias:"MOV"},"image/jpeg":{color:"grey",alias:"JPG"},"application/javascript":{color:"grey",alias:"JS"},"text/plain":{color:"grey",alias:"TXT"},"image/png":{color:"grey",alias:"PNG"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{color:"blue",alias:"DOC"},"application/msword":{color:"blue",alias:"DOC"},"image/bmp":{color:"grey",alias:"BMP"},"audio/basic":{color:"grey",alias:"AU"},"application/illustrator":{color:"grey",alias:"AI"}},initializer:function(){var c;if(this.get("viewType")=="thumbnail"){return}else{if(!this.get("isUploader")){c=GROUPS.UTILS.getTemplate("messageattachments_template");this._fCompiledTemplate=b.Handlebars.compile(c);if(this.get("attachments")){this._processAttachments(this.get("attachments"))}else{this._initCarousel()}}else{c=GROUPS.UTILS.getTemplate("attachmentCard_template");this._fCompiledTemplate=b.Handlebars.compile(c)}}this._carouselHandler=false},_processAttachments:function(c){var d=0,h=c.ygData.length,l=this,m,g,k;for(var f=0;f<h;f++){m=c.ygData[f];d+=m.size;m.size=GROUPS.UTILS.formatBytes(m.size);g=m.fileType;if(this.fileTypes[g]){m.colorCode=this.fileTypes[g].color;m.typeAlias=this.fileTypes[g].alias}else{m.colorCode="grey";m.typeAlias=""}k=m.photoInfo.length;if(k>0){for(var e=0;e<k;e++){if(m.photoInfo[e].photoType==="or"){m.link=m.photoInfo[e].displayURL}else{if(m.photoInfo[e].photoType==="tn"){m.thumbnailLink=m.photoInfo[e].displayURL}}m.link=m.link+"?download=1"}}m.STR_SAVE=GROUPS.YRB_STRINGS.STR_SAVE;m.STR_DELETE=GROUPS.YRB_STRINGS.STR_DELETE}c.totalSize=GROUPS.UTILS.formatBytes(d);c.numAttachments=h;c.STR_ATTACHMENTS=(h==1)?GROUPS.YRB_STRINGS.STR_ATTACHMENT:GROUPS.YRB_STRINGS.STR_ATTACHMENTS;this.render(c)},processAttData:function(c){var d=0,h=c.ygData.attachmentsInfo.length,l=this,m,g,k;for(var f=0;f<h;f++){m=c.ygData.attachmentsInfo[f];d+=m.size;m.size=GROUPS.UTILS.formatBytes(m.size);g=m.fileType;if(this.fileTypes[g]){m.colorCode=this.fileTypes[g].color;m.typeAlias=this.fileTypes[g].alias}else{m.colorCode="grey";m.typeAlias=""}k=m.photoInfo.length;if(k>0){m.photo=true;for(var e=0;e<k;e++){if(m.photoInfo[e].photoType==="or"){m.link=m.photoInfo[e].displayURL}else{if(m.photoInfo[e].photoType==="tn"){m.thumbnailLink=m.photoInfo[e].displayURL}}m.link=m.link+"?download=1"}}}c.ygData.totalSize=GROUPS.UTILS.formatBytes(d);c.ygData.numAttachments=h;c.ygData.STR_ATTACHMENTS=(h==1)?GROUPS.YRB_STRINGS.STR_ATTACHMENT:GROUPS.YRB_STRINGS.STR_ATTACHMENTS},render:function(g){var d=this._fCompiledTemplate(g),e,c,f;this.get("container").one(".msg-attachment-wrapper").setHTML(d);c=this.get("container").one(".msg-attachments-container");if(this.get("viewType")==="fullView"){if(g.ygData.length>0){e=c.all(".attachment-tray .wrapper").item(0).get("offsetWidth");f=(e+10)*g.ygData.length;c.one(".attachment-ul").setStyle("width",f+"px");this._initCarouselHandlers(e)}}else{}},_initCarousel:function(){var d,e,c=this.get("container").one(".msg-attachments-container");c.removeClass("hide");d=c.all(".attachment-tray .wrapper").item(0).get("offsetWidth");e=(d+10)*c.getData("length");c.one(".attachment-ul").setStyle("width",e+"px");this._initCarouselHandlers(d)},_attachAnim:function(c,e,f){var d=new b.Anim({node:c,to:{left:e},duration:0.5});d.on("end",function(){f()});d.run()},_initCarouselHandlers:function(h){var d=this.get("container").one(".msg-attachments-container"),e=this,c=d.one(".attachment-ul"),f=d.one(".attachment-tray .next"),g=d.one(".attachment-tray .prev");if(c.get("offsetWidth")<=d.get("offsetWidth")){f.addClass("hidden");g.addClass("hidden")}else{f.removeClass("hidden")}if(!this._carouselHandler){this._carouselHandler=true;f.on("click",function(m){var l=c.get("offsetLeft"),k=c.get("offsetWidth"),i=d.get("offsetWidth"),j;l=Math.abs(l);if(Math.abs(k-i)<=l){m.currentTarget.addClass("hidden")}else{j=(-(l)-(h*3));e._attachAnim(c,j,function(){if(Math.abs(j)+i>=k){f.addClass("hidden")}})}g.removeClass("hidden")});g.on("click",function(l){var k=c.get("offsetLeft"),j=c.get("offsetWidth"),i=d.get("offsetWidth");k=Math.abs(k);if(k<=0){l.currentTarget.addClass("hidden")}else{targetPos=(-(k)+(h*3));e._attachAnim(c,targetPos,function(){if(targetPos>=0){g.addClass("hidden")}})}f.removeClass("hidden")})}},_getAttachments:function(g){var e="/api/v1/groups/"+this.get("groupName")+"/messages/"+this.get("messageId")+"/attachments",f,c=this,d;GROUPS.DETAIL_IO.makeRequest(e,"GET",{},function(h,i){if(h){try{f=b.JSON.parse(h);if(f.ygData.length){g.call(c,f)}}catch(j){b.log("error while parsing the result")}}else{d=GROUPS.UTILS.getErrorYRBString(i.ygError.errorCode,"messages");c.get("container").append('<div class="msg-attachments-error">'+d+"</div>")}})}},{ATTRS:{viewType:{value:"thumbnail",validator:function(c){return c==="thumbnail"||c==="fullView"}},groupName:{value:""},messageId:{value:0},container:{value:null,validator:function(c){return b.Lang.isObject(c)&&c.constructor.NAME==="node"}},isUploader:{value:false},attachments:{value:""}}});b.namespace("Groups").MessageAttachments=a},"0.1",{requires:["json","handlebars"]});YUI.add("yg-inline-video-player",function(d,c){var a=GROUPS.PAGE._isMobile;function b(g,e,f){var h=d.Lang.now(),j;return function i(){var k=d.Lang.now();if(j){j.cancel()}if(k-h>e){h=k;g.apply(this,arguments)}else{j=d.later(f,this,i)}}}d.namespace("Groups.InlineVideoPlayer").initLazyLoadHandler=function(f,e){if(!e){return}if(!f._lazyPlayerSelector){f._lazyPlayerSelector=e;f._lazyPlayerHandle=d.on("scroll",b(function(){this.node.all(this._lazyPlayerSelector).each(function(g){var h=(g.getComputedStyle("display")!="none");if(h){g.all(".lazy-player-pending").each(function(j){var i;if(j.inViewportRegion()){j.set("outerHTML",'<iframe class="lazy-player" src="'+j.getData("src")+'" width="'+j.getComputedStyle("width")+'" height="'+j.getComputedStyle("height")+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>')}})}if(a){g.all(".lazy-player").each(function(k){var j,i,l,m;if(!k.inViewportRegion()){m=k.getAttribute("src");j='<div class="lazy-player-pending" data-src="'+m+'"></div>';k.set("outerHTML",j)}})}})},500,1000),d.config.win,f);f.after("destroyedChange",function(g){if(f.get("destroyed")&&f._lazyPlayerHandle){f._lazyPlayerHandle.detach()}});f._lazyPlayerHandle.evt.fire()}else{f._lazyPlayerSelector=e}}},"0.1",{requires:["node","querystring"]});YUI.add("yg-topic-read",function(a){a.Groups.TopicReadModel=a.Base.create("TopicReadModel",a.Model,[],{getTopicData:function(c,b){GROUPS.DETAIL_IO.makeRequest(c,"GET","",function(e,d){})},getAttachmentsData:function(d,c,b){GROUPS.DETAIL_IO.makeRequest(d,"GET","",function(f,e){if(e){}else{var g=a.JSON.parse(f);c.showAttachments(g,b)}})},getPollsData:function(e,d,b){var c="/api/v1/groups/"+e+"/polls/?topicId="+d;GROUPS.DETAIL_IO.makeRequest(c,"GET","",function(g,f){if(!f){var h=a.JSON.parse(g);b.showPollsRightRail(h)}})}},{ATTRS:{}});a.Groups.TopicReadView=a.Base.create("TopicReadView",a.View,[a.Groups.TopicBase],{defaultNumMsgs:5,updateMsglist:false,events:{".msg-container .quoted-container":{click:"_showQuotedMessage"},".msg-container .msg-header, .new-tab":{click:"_msgHeaderClickHandler"},".msg-container .expand-top, .msg-container .expand-bottom":{click:"_moreIconClickHandler"},".msg-container .qt-btn":{click:"_quickReplyHandler"},".msg-container .topic-send":{click:"_msgSendHandler"},".msg-container .topic-cancel":{click:"_msgCancelHandler"},".msg-container .msg-expand":{click:"_msgExpandHandler"},".msg-container .conv-box":{click:"_conversationClickHandler"},".quoted-container, .msg-header, .qt-btn, .conv-box, .topic-send, .topic-cancel, .expand-top, .expand-bottom":{keydown:"keyHandler"},".msg-container .reply-all-link":{click:"_replyAllLinkHandler"},".msg-container .msg-delete-btn":{click:"_showDeleteConfirm"},"#yg-msg-read .msg-title-bar #yg-msg-subject":{click:"_subjectHandler"},".photo-attachment-viewer":{click:"photoAttachmentHandler"},".pollslist-show-more":{click:"_pollsListShowMoreHandler"},".msg-pin-action":{click:"pinItActionHandler"}},initHandlers:function(){var c=this,b,g,d="CLEAR_APP_CACHE";c.sort={sortField:"date",sortOrder:"asc"};GROUPS.ACTIONBAR.init(c,c.delegateActionbarClickHandler);c.viewMenu=GROUPS.ACTIONBAR.viewOptions;GROUPS.Y.publish(d,{broadcast:2});this.initConfig();this.initCards(this.nodes);g=c.node.one(".msg-list-container");if(!(GROUPS.PAGE._isMobile)){g.delegate("mouseover",c.showCardHover,"li.yg-msg-read-container",c);g.delegate("mouseout",c.hideCardHover,"li.yg-msg-read-container",c)}c.alternateId=g.getData("alternateId");c.fromMailAddr=g.getData("fromMailAddr");c.replyTo=g.getData("reply-to");c.defaultEmail=this.get("groupName")+"@"+GROUPS.EMAIL_DOMAIN;c.isMember=g.getData("member-status");c.owner=c.get("groupName").toLowerCase()+"-owner@"+GROUPS.EMAIL_DOMAIN;if(this.node.one("#yg-recipients-template")){c.compiledRcptList=this.node.one("#yg-recipients-template").getHTML();c.compiledRcptList=a.Handlebars.compile(c.compiledRcptList)}if(GROUPS.CONFIG.attExplorerEnabled){c.compiledAttList=a.Handlebars.compile(GROUPS.UTILS.getTemplate("yg-att-explorer-rec_template"))}if(c.node.one(".reply-box")){c.replyBox=c.node.one(".reply-box")}c.conv=new a.Groups.Conversations(c,{viewType:"newMessageInline",fInstance:c.node,conversationType:"topics"});b=function(e){var h=c.node.one("#yg-thread-container").getAttribute("data-topic-"+(e?"prev":"next"));if(h.length>0){GROUPS.ROUTER.navigate(h)}};if(g){a.one(".msg-list-container").delegate("click",function(h){c.type="topic-read";GROUPS.UTILS.toggleRawMessage(h,h.target.ancestor(".yg-msg-read-container"),c)},".raw-msg-lnk button")}GROUPS.UTILS.handleRightRailSplitter(c.node.one(".yg-splitter"));c.plug(a.Groups.Plugin.SwipePage,{swipeRightHandle:function(){b.call(this,true)},swipeLeftHandle:function(){b.call(this,false)}});c.currentY=0;try{c._dockedHeight=a.one(".yucs-groups").get("offsetHeight")+a.one("#navbar-container").get("offsetHeight")+a.one("#yg-action-bar").get("offsetHeight")+9}catch(f){c._dockedHeight=176}},delegateActionbarClickHandler:function(f){var c=f.currentTarget.getAttribute("data-action"),d=f.currentTarget;if(c=="sort-date"){f.stopPropagation();var b=a.one("#yg-main-content .y-col2-2");this.reverseMessageOrder();if(this.msgOrder){d.one("i.desc").replaceClass("desc","asc")}else{d.one("i.asc").replaceClass("asc","desc")}if(b&&b.hasClass("hide")&&this.node.one(".msg-expand")){this.node.one(".msg-expand").remove()}}else{if(c=="view-mode"){f.stopPropagation();this._toggleTopicView(f)}else{if(c=="view-fwf"){f.stopPropagation();this._toggleFixedWidthFontView(f)}else{if(c=="reply-all"){f.stopPropagation();if(!f.currentTarget.hasClass("btn-disable")){this._replyAllBtnHandler(f)}}else{if(c=="msg-expand"){f.stopPropagation();GROUPS.UTILS.msgExpandHandle(f)}}}}}},_msgExpandHandler:function(b){GROUPS.UTILS.msgExpandHandle(b)},_toggleFixedWidthFontView:function(c){var b=this.node.one("#yg-iframe-container .msg-container .msg-list-container");if(b){if(b.hasClass("fixed-width-font")){c.currentTarget.setHTML(GROUPS.YRB_STRINGS.STR_FIXED_WIDTH_FONT);b.removeClass("fixed-width-font")}else{c.currentTarget.setHTML(GROUPS.YRB_STRINGS.STR_VARIABLE_WIDTH_FONT);b.addClass("fixed-width-font")}}},pinItActionHandler:function(d){var c=d.currentTarget.hasClass("msg-pin-action")?d.currentTarget:d.currentTarget.ancestor(".msg-pin-action"),b=this;if(!c.hasClass("pin-owner")){c.one("i").addClass("hide");c.one("span").setHTML('<div class="pinning"></div>'+GROUPS.YRB_STRINGS.STR_PINNING);GROUPS.UTILS.pinEntity(this.get("groupName"),"MESSAGE",d.target.ancestor(".card").getData("msgid"),function(g,f){if(f){c.one("i").removeClass("hide");c.one("span").setHTML(GROUPS.YRB_STRINGS.STR_PIN)}else{c.addClass("pin-owner");c.one("i").removeClass("hide");c.one("span").setHTML(GROUPS.YRB_STRINGS.STR_PINNED);var g=a.JSON.parse(g);c.setAttribute("data-pinid",g.ygData.pinId);c.setAttribute("data-tooltip",GROUPS.YRB_STRINGS.STR_UNPIN_TOOLTIP);var e=[a.WidgetPositionAlign.BR,a.WidgetPositionAlign.TR];if(GROUPS.PAGE._isMobile){e=[a.WidgetPositionAlign.BC,a.WidgetPositionAlign.TR]}GROUPS.UTILS.showPinSuccessMessage(c,b.get("groupName"),e,g.ygData.pinId,function(){GROUPS.UTILS.showNoteSaveSuccessMessage(c,b.get("groupName"))});GROUPS.INSTR.beaconClick("yg-topic-read","pin-message",1,false)}})}else{c.one("span").setHTML('<span class="pinning"></span>'+GROUPS.YRB_STRINGS.STR_UNPINNING);GROUPS.UTILS.unpinEntity(this.get("groupName"),c.getData("pinid"),function(f,e){if(e){c.one("i").removeClass("hide");c.one("span").setHTML(GROUPS.YRB_STRINGS.STR_PINNED)}else{c.removeClass("pin-owner");c.one("i").removeClass("hide");c.one("span").setHTML(GROUPS.YRB_STRINGS.STR_PIN);c.setAttribute("data-tooltip",GROUPS.YRB_STRINGS.STR_PIN_ON_MY_BOARD);GROUPS.INSTR.beaconClick("yg-topic-read","unpin-message",1,false)}})}},_showQuotedMessage:function(b){this.conv.showQuotedMessage(b)},_quickReplyHandler:function(d){var c=d.currentTarget,b=c.ancestor(".yg-msg-read-container");GROUPS.PAGE.hideTooltip();c.toggleClass("expanded");b.one(".msg-content .qreply").toggleClass("hide");if(c.hasClass("expanded")){c.setHTML('<i class="yg-sprite"></i>'+GROUPS.YRB_STRINGS.STR_HIDE_MSG_HISTORY);GROUPS.INSTR.beaconClick("yg-iframe-container","topic-show-quoted",1,false)}else{c.setHTML('<i class="yg-sprite"></i>'+GROUPS.YRB_STRINGS.STR_MSG_HISTORY);GROUPS.INSTR.beaconClick("yg-iframe-container","topic-hide-quoted",1,false)}},photoAttachmentHandler:function(c){var b=c.currentTarget.getAttribute("link");if(b){GROUPS.UTILS.openAttachmentPreview(c.currentTarget,b)}},_subjectHandler:function(d){var c=d.currentTarget;var b=a.one(".msg-title-bar");if(c.hasClass("wrap")){c.removeClass("wrap")}else{c.addClass("wrap")}},_replyCloseHandler:function(c){var b=c.currentTarget;c.currentTarget=this.replyBox.one(".topic-cancel");this.conv.replyCancelHandler(c);this.replyBox.removeClass("maximized");this.node.one(".reply-all-btn").removeClass("btn-disabled");if(this.replyBox.hasClass("reply-link")){b.ancestor(".yg-msg-reply-container").remove(true)}else{this.replyBox.one(".conv-box").removeClass("hide");this.replyBox.addClass("conv-box-container");window.scrollTo(0,GROUPS.PAGE.dockPos);GROUPS.PAGE._dockNode()}GROUPS.PAGE.hideTooltip();GROUPS.INSTR.beaconClick("yg-iframe-container","topic-reply-cancel",2,false)},_replyAllLinkHandler:function(h){h.preventDefault();var f=this.node.one(".yg-msg-reply-container"),c,g=h.currentTarget,d,b;if(f){f.remove()}if(this.node.one(".conv-box")&&this.node.one(".conv-box").hasClass("hide")){this._replyCloseHandler({currentTarget:null})}c=g.ancestor(".yg-msg-read-container");next=c.next();b=c.get("parentNode");d='<div class="compose-box" data-alternateId="'+this.alternateId+'" data-fromMailAddr="'+this.fromMailAddr+'"></div>';f=a.Node.create('<li class="yg-msg-reply-container card-border-bottom"><div class="reply-box reply-link">'+d+"</div></li>");b.insertBefore(f,next);this.showReplyBox(h,f);this.scrollToContent();this.alignReplyBoxToBottom();GROUPS.PAGE._dockNode()},_replyAllBtnHandler:function(b){this.showReplyBox(b);this.scrollToContent();this.alignReplyBoxToBottom();GROUPS.PAGE._dockNode()},initializer:function(){var b=this;b.node=b.get("container");b.ygPanel="";b._evt=[];this.after("destroyedChange",function(c){if(b.get("destroyed")){b.handleDestroy()}})},handleDestroy:function(){a.each(this._evt,function(b){b.detach()});this._evt=[]},render:function(){if(this.get("html")!==""){var c=a.Node.create("<div>"+this.get("html")+"</div>");var b;b=c.one(".group-detail-view");this.node.addClass("group-detail-view");this.node.setHTML(b.getHTML())}return this},initView:function(){var b,e,g,i,c=this,f=a.one("#tooltip"),h,d;a.use("yg-panel","json","handlebars","node-menunav","yg-conversations-common",function(k){if(c.node.one("#yg-thread-container")){c.initHandlers();c.inReplyToHeaderValue=null}c.topicModel=new k.Groups.TopicReadModel();if(GROUPS.CONFIG.attExplorerEnabled){this.inProgress=true;c.topicModel.getAttachmentsData("/api/v1/groups/"+c.get("groupName")+"/topics/"+c.get("msgId")+"/attachments?start=0&count=3&includeTotalCount=true",c,true)}GROUPS.PAGE.showAds(true,false);GROUPS.UTILS.fetchThumbnails(c.node);k.Groups.InlineVideoPlayer.initLazyLoadHandler(c,".yg-msg-read-container .msg-inline-video");c.topicModel.getPollsData(c.get("groupName"),c.get("msgId"),c);if(GROUPS.UTILS.getQueryStringValue("reverse")){c.sort={sortField:"date",sortOrder:"desc"};c.reverseMessageOrder()}if(GROUPS.CONFIG.pinboardEnabled){var j=[];c.node.all(".yg-msg-read-container").each(function(l){j.push(l.getData("msgid"))});GROUPS.UTILS.getPinInfo(c.get("groupName"),j,"MESSAGE",function(n,o){if(!o){n=k.JSON.parse(n);if(n.ygData.length>0){var l={};for(var m=0;m<n.ygData.length;m++){l[n.ygData[m].entityId]=n.ygData[m]}c.node.all(".yg-msg-read-container").each(function(p){var q=p.getData("msgid");if(l[q]&&l[q].isPinnedByMe){p.one(".msg-pin-action span").setHTML(GROUPS.YRB_STRINGS.STR_PINNED);p.one(".msg-pin-action").setAttribute("data-pinid",l[q].pinId);p.one(".msg-pin-action").setAttribute("data-tooltip",GROUPS.YRB_STRINGS.STR_UNPIN_TOOLTIP);p.one(".msg-pin-action").addClass("pin-owner")}if(l[q]){p.one(".msgread-pincount div").setHTML(l[q].pinCount)}})}}})}})},showAttachments:function(e,j){var g,l=this,d,k,h,b,c,f={};f=e.ygData;for(g in f.attachments){h=f.attachments[g];if(h.type=="photo"){h.link=h.photoInfo[h.photoInfo.length-1]["displayURL"]+"?download=1";h.hrLink=h.photoInfo[h.photoInfo.length-2]["displayURL"];h.width=h.photoInfo[h.photoInfo.length-2]["width"];h.height=h.photoInfo[h.photoInfo.length-2]["height"];if(h.photoInfo[0]["photoType"]=="tn"){h.thumbnailLink=h.photoInfo[0]["displayURL"]}}h.mtype=GROUPS.UTILS.getFileTypeIcon(h.fileType);h.fsize=GROUPS.UTILS.formatBytes(h.size);h.sfilename=h.filename;if(h.filename&&h.filename.length>23){h.sfilename=h.filename.substr(0,11)+"..."+h.filename.substr(-7)}}c=this.compiledAttList(f);if(j){if(f.count>1){k=a.Handlebars.compile(GROUPS.UTILS.getTemplate("yg-att-explorer_template"));f.attachmentsHTML=c;b=k(f);this.node.one("#yom-ad-LREC").insert(a.Node.create(b),"before");d=this.node.one("#yg-att-explorer");l._evt.push(d.one(".yg-att-ft a").on("click",function(i){l._evt.push(d.one(".yg-att-bd").on("scroll",l.loadMore,l));l.loadMore(i,true)},this));if(f.count<4){d.one(".yg-att-ft").addClass("hide")}GROUPS.INSTR.addModules("yg-att-explorer");d.delegate("click",l.showAttachmentPreview,'li a[type="img"]',l)}}else{d=this.node.one("#yg-att-explorer");d.one(".yg-att-container").appendChild(a.Node.create(c));d.one(".yg-att-ft").addClass("hide");GROUPS.INSTR.refreshModule("yg-att-explorer")}GROUPS.UTILS.fetchThumbnails(d);this.inProgress=false},showAttachmentPreview:function(d){d.preventDefault();var c=d.currentTarget;var b=c.getAttribute("link");if(b){GROUPS.UTILS.openAttachmentPreview(c,b)}},loadMore:function(g,d){var c,h,f,b=this.node.one("#yg-att-explorer .yg-att-bd");c=this.node.one("#yg-att-explorer .yg-att-hd").getAttribute("data-total");h=this.node.all("#yg-att-explorer .yg-att-container li").size();f=(b.get("scrollHeight")-b.get("scrollTop")-b.get("clientHeight")<50);if(!d&&(!f||this.inProgress)){return}if(h<c){this.inProgress=true;this.topicModel.getAttachmentsData("/api/v1/groups/"+this.get("groupName")+"/topics/"+this.get("msgId")+"/attachments?start="+h+"&count=10&includeTotalCount=false",this,false)}else{this.handleDestroy()}},showPollsRightRail:function(h){var b=this,h=h.ygData;if(h.length<1){return}for(var e=0;e<h.length;e++){h[e].pollURL="/neo/groups/"+b.get("groupName")+"/polls/poll/"+h[e].surveyId;if(e<3){h[e].show=true}}templateData={count:h.length,polls:h,showMore:(h.length>3)};var d=GROUPS.UTILS.getTemplate("pollsList_RightRail_template"),f=a.Handlebars.compile(d),c=f(templateData),g=a.Node.create(c);b.node.one("#right-rail-container *").insert(g,"before");GROUPS.INSTR.addModules("polls-right-rail-list")},_pollsListShowMoreHandler:function(g){g.preventDefault();var b=this,f=g.currentTarget,c=f.ancestor(".yg-polls-ft"),d=b.node.all("#right-rail-container .yg-pollslist-item");d.removeClass("hide");c.addClass("hide")},initCards:function(b){var c,e,d;b.each(function(f){c=f.one("span[title=qreply]");d=f.one(".card-action-bar");if(c){c.removeAttribute("title");e=a.Node.create('<div class="card-action-bar"><span class="qt-btn yg-font"><i class="yg-sprite"></i>'+GROUPS.YRB_STRINGS.STR_MSG_HISTORY+"</span></div>");c.addClass("qreply hide");f.one(".msg-content").insertBefore(e,c)}else{d.removeClass("hide")}})},reverseMessageOrder:function(){var d=this.node.one(".msg-list-container"),b=this.node.one(".msg-more-icon"),c=null;if(d.one(".yg-msg-reply-container")){d.one(".yg-msg-reply-container").remove()}d.append(this.nodes._nodes.reverse());this.msgOrder=!this.msgOrder;if(b){c=b.getHTML();b.remove();this.renderMoreIcon(c)}},_toggleTopicView:function(f){var c,b=this.node.one(".msg-more-icon"),g;if(b){b.remove()}if(!this.topicFolded){c="topic-fold";f.currentTarget.removeClass("yg-topic-unfold");f.currentTarget.setHTML(GROUPS.YRB_STRINGS.NAV_EXPAND);GROUPS.PAGE.hideTooltip();if(this.nodesNumber>this.defaultNumMsgs){this.nodes.addClass("card");this.showThreadedView()}else{this.nodes.removeClass("card")}this.topicFolded=true;try{g=parseInt(a.one("#yg-grp-main-img").get("offsetHeight")+10,10)}catch(d){g=210}window.scrollTo(0,g)}else{c="topic-unfold";this.showAllMessages();if(this.nodesNumber<this.msgCount){this.renderMoreIcon()}}GROUPS.INSTR.beaconClick("yg-action-bar",c,1,false)},showCardHover:function(c){var b=c.currentTarget;b.one(".cur-msg").removeClass("hide")},hideCardHover:function(c){var b=c.currentTarget;if(!b.one(".cur-msg").hasClass("vis")){b.one(".cur-msg").addClass("hide")}},setHeight:function(){var b=this.node.one("body").get("offsetHeight");this.msgIframe.setStyle("height",b+100)},showAllMessages:function(b){if(GROUPS.ACTIONBAR.viewOverlay){this.viewMenu=GROUPS.ACTIONBAR.viewOverlay.get("contentBox")}this.nodes.removeClass("hide");this.nodes.addClass("card");this.topicFolded=false;this.viewMenu.one(".yg-topic-fold").setHTML(GROUPS.YRB_STRINGS.NAV_COLLAPSE);GROUPS.PAGE.hideTooltip()},deleteMessage:function(){var g=this.readContainer.getData("msgid"),h,b=this,c,f,e="CLEAR_APP_CACHE",d="/api/v1/groups/"+this.get("groupName")+"/messages/"+g;this.ygPanel.hide();this.showProgress(GROUPS.YRB_STRINGS.STR_DELETING_MSG);GROUPS.DETAIL_IO.makeRequest(d,"DELETE",null,function(k,j){b.hideProgress();if(j){}else{GROUPS.Y.Global.fire(e,{});f=b.node.one(".msg-list-container").getData("msgCount");if(f==1){c=GROUPS.TOPICS_URL_TEMPLATE.replace("%groupName%",b.get("groupName"));GROUPS.ROUTER.navigate(c);return}h=a.Node.create('<p class="inline-response fc-gray">'+GROUPS.YRB_STRINGS.STR_DELETE_MSG_SUCCESS+"</p>");b.readContainer.replaceClass("yg-msg-read-container","yg-msg-reply-container");b.readContainer.replaceClass("card","card-border-bottom");b.readContainer.setHTML(h);var i=b.node.one(".msg-more-icon");if(i){i.remove()}a.later(3000,a,function(){GROUPS.UTILS.handleTransition(h,function(){b.readContainer.remove(true);c=b.node.one("#yg-thread-container").getData("topic-current");GROUPS.ROUTER.navigate(c)})})}})},_showDeleteConfirm:function(i){GROUPS.PAGE.hideTooltip();var c,h,g=i.currentTarget,d,b,f;this.readContainer=i.currentTarget.ancestor(".yg-msg-read-container");if(!this.ygPanel){c=GROUPS.UTILS.getTemplate("deleteMessage_template");d=a.Handlebars.compile(c);c=d({});h=a.Node.create(c);h=h.one("#yg-delete-msg-panel");this.ygPanel=new a.Groups.Panel({srcNode:h,moveNode:h.ancestor(".yui3-skin-sam"),visible:true,view:this});a.on("click",function(j){this.ygPanel.hide();GROUPS.INSTR.beaconClick("yg-iframe-container","topic-delete-cancel",2,false)},"#msg-del-cancel",this);a.on("click",function(j){this.deleteMessage();GROUPS.INSTR.beaconClick("yg-iframe-container","topic-delete-ok",1,false)},"#msg-del-ok",this)}this.ygPanel.show();GROUPS.INSTR.beaconClick("yg-iframe-container","topic-delete-click",2,false)},showProgress:function(b){var c,d=a.one(".page-loader");d.setHTML(b);c=d.get("offsetWidth");d.setStyle("marginLeft",-c/2);d.removeClass("hide")},hideProgress:function(){var b=a.one(".page-loader");b.addClass("hide");b.setStyle("marginLeft",0);b.setHTML(GROUPS.YRB_STRINGS.STR_LOADING_MESSAGE)}},{ATTRS:{groupName:{value:""},msgId:{value:""},html:{value:""},subtype:{value:""}}});GROUPS.VIEWS["yg-topic-read"]=a.Groups.TopicReadView},"0.1",{requires:["model","view","groups-io","yg-plugin-swipe-page","yg-message-attachments","yg-topic-base"]});/*
YUI 3.15.0 (build 834026e)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("querystring-parse",function(e,t){var n=e.namespace("QueryString"),r=function(t){return function r(i,s){var o,u,a,f,l;return arguments.length!==2?(i=i.split(t),r(n.unescape(i.shift()),n.unescape(i.join(t)))):(i=i.replace(/^\s+|\s+$/g,""),e.Lang.isString(s)&&(s=s.replace(/^\s+|\s+$/g,""),isNaN(s)||(u=+s,s===u.toString(10)&&(s=u))),o=/(.*)\[([^\]]*)\]$/.exec(i),o?(f=o[2],a=o[1],f?(l={},l[f]=s,r(a,l)):r(a,[s])):(l={},i&&(l[i]=s),l))}},i=function(t,n){return t?e.Lang.isArray(t)?t.concat(n):!e.Lang.isObject(t)||!e.Lang.isObject(n)?[t].concat(n):s(t,n):n},s=function(e,t){for(var n in t)n&&t.hasOwnProperty(n)&&(e[n]=i(e[n],t[n]));return e};n.parse=function(t,n,s){return e.Array.reduce(e.Array.map(t.split(n||"&"),r(s||"=")),{},i)},n.unescape=function(e){return decodeURIComponent(e.replace(/\+/g," "))}},"3.15.0",{requires:["yui-base","array-extras"]});
